<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Aisling</title>
    
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="./node_modules/pouchdb/dist/pouchdb.js"></script>
    <script src="modules.js"></script>
  </head>
  <body>
    
    <div id="div_entries">
        <ul id="ul_entries">
        </ul>
    </div>
    <div id="div_detail">
        <div id="div_view_bts" class="top_bts">
            <div id="bt_new">new</div>
            <div id="bt_edit">edit</div>
        </div>
        <div id="div_edit_bts" class="top_bts" style="display:none">
            <div id="bt_save">save</div>
            <div id="bt_cancel">cancel</div>
        </div>
    </div>

    
    <script>
        PouchDB.plugin(require('pouchdb-adapter-leveldb'));
        let db_path = 'C:\\Users\\flux\\data\\aisling.db';
        //let db_path = './aisling.db';
        let db = new PouchDB(db_path, {adapter: 'leveldb'});
        //let db = new PouchDB(db_path, {adapter: 'websql'});
        
        console.log(db.adapter);

        db.info().then(function (info) {
            console.log(info);
        });

        function load_default_db() {
            var default_db = require('./default_db.json');
            for (let i=0; i<default_db.entries.length; ++i) {
                var entry = default_db.entries[i];
                db.put(entry)
                .then(function (response) {
                    console.log('entry saved');
                }).catch(function (err) {
                    console.log(err);
                });
            }
        }

        //load_default_db();


        let div_detail = document.querySelector('#div_detail');

        let module_names = ['word', 'definition'];
        let modules = []
        for (let i=0; i<module_names.length; ++i) {
            let container = document.createElement('div');
            let module = null;
            if (module_names[i] === 'word') {
                module = new ModuleWord(container);
            } else if (module_names[i] === 'definition') {
                module = new ModuleDefinition(container);
            } else {
                console.error('unrecognized module "'+module_names[i]+'"');
                continue;
            }
            
            modules.push(module);
            div_detail.appendChild(container);
        }

        function load_entry(entry) {
            for (let i=0; i<modules.length; ++i) {
                modules[i].switch_to_view_mode(entry);
            }
        }

        db.get("aisling").then(function(entry) {
            load_entry(entry);
        }).catch(function (err) {
            console.log(err);
        });

        let ul_entries = document.querySelector('#ul_entries');
        function add_word(word) {
            let li = document.createElement('li');
            li.innerText = word;
            li.onclick = function() {
                for (let i=0; i<ul_entries.children.length; ++i) {
                    let c = ul_entries.children[i];
                    if (c.hasAttribute('selected')) {
                        c.style.color = null;
                        c.removeAttribute('selected');
                    }
                }
                this.style.color = 'white';
                this.setAttribute('selected', 'selected');
            }
            ul_entries.appendChild(li);
        }

        for (let i=0; i<100; ++i) {
            add_word(['a', 'b', 'c'][i%3]);
        }



        let bt_new = document.querySelector('#bt_new');
        let bt_edit = document.querySelector('#bt_edit');
        let bt_save = document.querySelector('#bt_save');
        let bt_cancel = document.querySelector('#bt_cancel');


        bt_new.onclick = function() {

        }

        

    </script>

  </body>
</html>
